<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Hub Quiz</title>
    <script>
        let currentQuestionIndex = 0;
        let quizData = [];
        let userResponses = [];

        function submitUrl() {
            const videoUrl = document.getElementById('videoUrl').value;
            fetch('/api/createQuiz', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ videoUrl })
            }).then(response => response.json())
              .then(data => {
                  alert(`Response: ${JSON.stringify(data)}`);
                  if (data.quiz) {
                      quizData = data.quiz;
                      document.getElementById('videoContainer').innerHTML = 
                          `<iframe width="560" height="315" src="${videoUrl.replace('watch?v=', 'embed/')}" 
                          frameborder="0" allowfullscreen></iframe>`;
                      displayQuestion();
                  }
              })
              .catch(error => console.error('Error:', error));
        }

        function displayQuestion() {
            if (currentQuestionIndex < quizData.length) {
                const question = quizData[currentQuestionIndex];
                let html = `<h2>Question ${currentQuestionIndex + 1}: ${question.question}</h2>`;
                question.options.forEach((option, index) => {
                    html += `<button onclick="selectAnswer('${option}')">${option}</button> `;
                });

                if (currentQuestionIndex === quizData.length - 1) {
                    html += `<br><br><input type="email" id="userEmail" placeholder="Enter your email" required>
                             <button onclick="submitQuiz()">Submit</button>`;
                } else {
                    html += `<br><br><button onclick="nextQuestion()" style="display:none;" id="nextButton">Next</button>`;
                }
                document.getElementById('quizContainer').innerHTML = html;
            }
        }

        function selectAnswer(answer) {
            userResponses.push({ question: quizData[currentQuestionIndex].question, answer });
            if (document.getElementById('nextButton')) {
                document.getElementById('nextButton').style.display = 'inline-block';
            }
        }

        function nextQuestion() {
            currentQuestionIndex++;
            displayQuestion();
        }

        function submitQuiz() {
            const email = document.getElementById('userEmail').value;
            if (!email) {
                alert("Please enter your email before submitting.");
                return;
            }
            fetch('/api/submitQuiz', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, responses: userResponses })
            }).then(response => response.json())
              .then(data => {
                  alert(`Quiz submitted! Check your email.`);
                  location.reload();
              })
              .catch(error => console.error('Error:', error));
        }
    </script>
</head>
<body>
    <h1>AI Hub Quiz - <span id="quizFileName"></span></h1>
    <input type="text" id="videoUrl" placeholder="Enter YouTube Video URL">
    <button onclick="submitUrl()">Submit</button>
    
    <div id="videoContainer"></div>
    <div id="quizContainer"></div>
</body>
</html>





